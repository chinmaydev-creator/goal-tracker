<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goal Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .main-wrapper {
            display: flex;
            gap: 20px;
            width: 100%;
            max-width: 1400px;
            height: 90vh;
            overflow: hidden;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 50px;
            width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
            overflow-y: auto;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 40px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .header h1 {
            font-size: 32px;
            color: #333;
            font-weight: 600;
        }

        .profile-section {
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            border-radius: 12px;
            border: 2px solid #e0e0e0;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .profile-header h3 {
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }

        .profile-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .profile-select {
            flex: 1;
            min-width: 150px;
            padding: 10px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 16px;
            color: #333;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .profile-select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .profile-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .profile-btn.add {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .profile-btn.add:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .profile-btn.delete {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        .profile-btn.delete:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .profile-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .slider-group {
            margin-bottom: 30px;
        }

        .slider-label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            display: block;
            cursor: pointer;
            transition: color 0.3s;
            user-select: none;
        }

        .slider-label:hover {
            color: #667eea;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
            transition: all 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
            transition: all 0.2s;
        }

        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.5);
        }

        .percentage-label {
            min-width: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.2);
        }

        /* Custom range track styling */
        input[type="range"]::-webkit-slider-runnable-track {
            background: linear-gradient(to right, #e0e0e0 0%, #e0e0e0 100%);
            height: 8px;
            border-radius: 5px;
        }

        input[type="range"]::-moz-range-track {
            background: #e0e0e0;
            height: 8px;
            border-radius: 5px;
            border: none;
        }

        .datalist {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: #999;
            padding: 0 5px;
        }

        .datalist span {
            position: relative;
        }

        /* Progress Panel */
        .progress-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            width: 900px;
            height: calc(90vh - 100px);
            overflow-y: auto;
            flex-shrink: 0;
            display: none;
            flex-direction: column;
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 500;
        }

        .progress-panel.active {
            display: flex;
        }

        .progress-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .progress-panel-header h2 {
            font-size: 24px;
            color: #333;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #333;
        }

        .progress-bar-container {
            margin-bottom: 30px;
        }

        .progress-bar-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
            transition: width 0.3s ease;
        }

        .table-container {
            flex: 1;
            overflow-y: auto;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .table-header h3 {
            font-size: 18px;
            color: #333;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-delete {
            background: #ff6b6b;
            color: white;
            padding: 6px 10px;
            font-size: 12px;
        }

        .btn-delete:hover {
            background: #ff5252;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th {
            background: #f9f9f9;
            padding: 12px;
            text-align: left;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        td input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        td input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        tr:hover {
            background: #f9f9f9;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state p {
            margin-bottom: 15px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .modal-body {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .modal-body input {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .modal-body input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-cancel {
            background: #f0f0f0;
            color: #333;
        }

        .btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* Save button */
        .save-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
            transition: all 0.3s;
            z-index: 600;
        }

        .save-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .save-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 2000;
        }

        .save-notification.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-wrapper {
                flex-direction: column;
                height: auto;
            }

            .container {
                width: 100%;
                max-height: none;
            }

            .progress-panel {
                position: static;
                transform: none;
                width: 100%;
                height: auto;
                max-height: 85vh;
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .logo {
                width: 40px;
                height: 40px;
                font-size: 22px;
            }

            .slider-container {
                gap: 10px;
            }

            .percentage-label {
                min-width: 50px;
                padding: 6px 10px;
                font-size: 14px;
            }

            .save-btn {
                bottom: 20px;
                right: 20px;
                padding: 12px 24px;
                font-size: 14px;
            }
        }
    </style>
</head>

<body>
    <button class="save-btn" id="saveBtn">üíæ Save All</button>
    <div class="save-notification" id="saveNotification">‚úì Data saved successfully!</div>

    <div class="main-wrapper">
        <div class="container">
            <div class="header">
                <div class="logo">üìä</div>
                <h1>Goal Tracker</h1>
            </div>

            <div class="profile-section">
                <div class="profile-header">
                    <h3>üë§ Profile</h3>
                </div>
                <div class="profile-controls">
                    <select class="profile-select" id="profileSelect">
                        <option value="default">Default Profile</option>
                    </select>
                    <button class="profile-btn add" id="addProfileBtn">‚ûï New</button>
                    <button class="profile-btn delete" id="deleteProfileBtn">üóëÔ∏è Delete</button>
                </div>
            </div>

            <div class="slider-group">
                <label class="slider-label">Algorithms</label>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <input type="range" id="algorithms" min="0" max="100" value="0">
                    </div>
                    <div class="percentage-label" id="algorithms-label">0%</div>
                </div>
                <div class="datalist">
                    <span>0%</span>
                    <span>25%</span>
                    <span>50%</span>
                    <span>75%</span>
                    <span>100%</span>
                </div>
            </div>

            <div class="slider-group">
                <label class="slider-label">Data Structures</label>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <input type="range" id="dataStructures" min="0" max="100" value="0">
                    </div>
                    <div class="percentage-label" id="dataStructures-label">0%</div>
                </div>
                <div class="datalist">
                    <span>0%</span>
                    <span>25%</span>
                    <span>50%</span>
                    <span>75%</span>
                    <span>100%</span>
                </div>
            </div>

            <div class="slider-group">
                <label class="slider-label">Low Level Design</label>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <input type="range" id="lowLevelDesign" min="0" max="100" value="0">
                    </div>
                    <div class="percentage-label" id="lowLevelDesign-label">0%</div>
                </div>
                <div class="datalist">
                    <span>0%</span>
                    <span>25%</span>
                    <span>50%</span>
                    <span>75%</span>
                    <span>100%</span>
                </div>
            </div>

            <div class="slider-group">
                <label class="slider-label">High Level Design</label>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <input type="range" id="highLevelDesign" min="0" max="100" value="0">
                    </div>
                    <div class="percentage-label" id="highLevelDesign-label">0%</div>
                </div>
                <div class="datalist">
                    <span>0%</span>
                    <span>25%</span>
                    <span>50%</span>
                    <span>75%</span>
                    <span>100%</span>
                </div>
            </div>

            <div class="slider-group">
                <label class="slider-label">Kubernetes</label>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <input type="range" id="kubernetes" min="0" max="100" value="0">
                    </div>
                    <div class="percentage-label" id="kubernetes-label">0%</div>
                </div>
                <div class="datalist">
                    <span>0%</span>
                    <span>25%</span>
                    <span>50%</span>
                    <span>75%</span>
                    <span>100%</span>
                </div>
            </div>
        </div>

        <!-- Progress Panel -->
        <div class="progress-panel" id="progressPanel">
            <div class="progress-panel-header">
                <h2 id="panelTitle">Algorithms</h2>
                <button class="close-btn" id="closePanelBtn">‚úï</button>
            </div>

            <div class="progress-bar-container">
                <div class="progress-bar-label">Overall Progress</div>
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="progressBarFill" style="width: 0%;">0%</div>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <h3>Daily Progress</h3>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="addRowBtn">+ Add Row</button>
                        <button class="btn btn-secondary" id="addColBtn">+ Add Column</button>
                    </div>
                </div>

                <div id="tableWrapper">
                    <div class="empty-state">
                        <p>No progress entries yet</p>
                        <p>Click "Add Row" to get started</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Column Dialog Modal -->
        <div class="modal" id="columnModal">
            <div class="modal-content">
                <div class="modal-header">Add New Column</div>
                <div class="modal-body">
                    <input type="text" id="columnNameInput" placeholder="Column name" />
                </div>
                <div class="modal-footer">
                    <button class="btn btn-cancel" id="cancelColBtn">Cancel</button>
                    <button class="btn btn-primary btn-save" id="confirmColBtn">Add</button>
                </div>
            </div>
        </div>

        <script>
            const profiles = JSON.parse(localStorage.getItem('goalTrackerProfiles')) || {
                default: {
                    sliders: {
                        algorithms: 0,
                        dataStructures: 0,
                        lowLevelDesign: 0,
                        highLevelDesign: 0,
                        kubernetes: 0
                    },
                    progressData: {
                        algorithms: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] },
                        dataStructures: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] },
                        lowLevelDesign: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] },
                        highLevelDesign: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] },
                        kubernetes: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] }
                    }
                }
            };

            let currentProfile = localStorage.getItem('goalTrackerCurrentProfile') || 'default';
            
            const state = {
                sliders: { ...profiles[currentProfile].sliders },
                progressData: JSON.parse(JSON.stringify(profiles[currentProfile].progressData)),
                currentPanel: null
            };

            const sliders = [
                { id: 'algorithms', labelId: 'algorithms-label', name: 'Algorithms' },
                { id: 'dataStructures', labelId: 'dataStructures-label', name: 'Data Structures' },
                { id: 'lowLevelDesign', labelId: 'lowLevelDesign-label', name: 'Low Level Design' },
                { id: 'highLevelDesign', labelId: 'highLevelDesign-label', name: 'High Level Design' },
                { id: 'kubernetes', labelId: 'kubernetes-label', name: 'Kubernetes' }
            ];

            const $ = id => document.getElementById(id);
            const progressPanel = $('progressPanel');
            const panelTitle = $('panelTitle');
            const progressBarFill = $('progressBarFill');
            const tableWrapper = $('tableWrapper');
            const addRowBtn = $('addRowBtn');
            const addColBtn = $('addColBtn');
            const closePanelBtn = $('closePanelBtn');
            const saveBtn = $('saveBtn');
            const saveNotification = $('saveNotification');
            const columnModal = $('columnModal');
            const columnNameInput = $('columnNameInput');
            const confirmColBtn = $('confirmColBtn');
            const cancelColBtn = $('cancelColBtn');
            const profileSelect = $('profileSelect');
            const addProfileBtn = $('addProfileBtn');
            const deleteProfileBtn = $('deleteProfileBtn');

            function updateSliderBackground(slider) {
                const value = (slider.value - slider.min) / (slider.max - slider.min) * 100;
                slider.style.background = `linear-gradient(to right, #667eea 0%, #764ba2 ${value}%, #e0e0e0 ${value}%, #e0e0e0 100%)`;
            }

            function openProgressPanel(sliderId, sliderName) {
                state.currentPanel = sliderId;
                panelTitle.textContent = sliderName;
                progressPanel.classList.add('active');
                const percentage = state.sliders[sliderId];
                progressBarFill.style.width = `${percentage}%`;
                progressBarFill.textContent = `${percentage}%`;
                renderTable();
            }

            function closeProgressPanel() {
                progressPanel.classList.remove('active');
                state.currentPanel = null;
            }

            function renderTable() {
                if (!state.currentPanel) return;

                const data = state.progressData[state.currentPanel];
                if (data.rows.length === 0) {
                    tableWrapper.innerHTML = '<div class="empty-state"><p>No progress entries yet</p><p>Click "Add Row" to get started</p></div>';
                    return;
                }

                const table = document.createElement('table');
                const headerRow = document.createElement('tr');
                
                data.columns.forEach(col => {
                    const th = document.createElement('th');
                    th.textContent = col;
                    headerRow.appendChild(th);
                });
                
                const actionTh = document.createElement('th');
                actionTh.textContent = 'Action';
                headerRow.appendChild(actionTh);
                table.appendChild(headerRow);

                data.rows.forEach((row, rowIndex) => {
                    const tr = document.createElement('tr');
                    
                    row.forEach((cell, colIndex) => {
                        const td = document.createElement('td');
                        const input = document.createElement('input');
                        const colName = data.columns[colIndex].toLowerCase();
                        
                        // Use date input for Date columns
                        if (colName.includes('date')) {
                            input.type = 'date';
                            input.value = cell || new Date().toISOString().split('T')[0];
                        } 
                        // Use number input for Hour/Hours columns
                        else if (colName.includes('hour')) {
                            input.type = 'number';
                            input.min = '0';
                            input.step = '1';
                            input.value = cell || '0';
                        } 
                        else {
                            input.type = 'text';
                            input.value = cell;
                        }
                        
                        input.addEventListener('change', e => {
                            data.rows[rowIndex][colIndex] = e.target.value;
                        });
                        td.appendChild(input);
                        tr.appendChild(td);
                    });

                    const actionTd = document.createElement('td');
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn btn-delete';
                    deleteBtn.textContent = 'üóëÔ∏è Delete';
                    deleteBtn.addEventListener('click', () => {
                        data.rows.splice(rowIndex, 1);
                        renderTable();
                    });
                    actionTd.appendChild(deleteBtn);
                    tr.appendChild(actionTd);
                    table.appendChild(tr);
                });

                tableWrapper.innerHTML = '';
                tableWrapper.appendChild(table);
            }

            function loadProfilesList() {
                profileSelect.innerHTML = '';
                Object.keys(profiles).sort().forEach(profileName => {
                    const option = document.createElement('option');
                    option.value = profileName;
                    option.textContent = profileName === 'default' ? 'Default Profile' : profileName;
                    option.selected = profileName === currentProfile;
                    profileSelect.appendChild(option);
                });
                deleteProfileBtn.disabled = currentProfile === 'default' || Object.keys(profiles).length === 1;
            }

            function switchProfile(profileName) {
                if (!profiles[profileName]) return;
                
                currentProfile = profileName;
                state.sliders = { ...profiles[profileName].sliders };
                state.progressData = JSON.parse(JSON.stringify(profiles[profileName].progressData));
                state.currentPanel = null;
                
                localStorage.setItem('goalTrackerCurrentProfile', currentProfile);
                
                sliders.forEach(slider => {
                    const element = $(slider.id);
                    const labelElement = $(slider.labelId);
                    element.value = state.sliders[slider.id] || 0;
                    labelElement.textContent = `${element.value}%`;
                    updateSliderBackground(element);
                });
                
                if (progressPanel.classList.contains('open')) {
                    closeProgressPanel();
                }
                
                loadProfilesList();
            }

            function saveProfiles() {
                profiles[currentProfile] = {
                    sliders: { ...state.sliders },
                    progressData: JSON.parse(JSON.stringify(state.progressData))
                };
                localStorage.setItem('goalTrackerProfiles', JSON.stringify(profiles));
            }

            function addProfile() {
                const profileName = prompt('Enter profile name:');
                if (!profileName) return;
                
                const trimmedName = profileName.trim();
                if (!trimmedName) {
                    alert('Profile name cannot be empty!');
                    return;
                }
                
                if (profiles[trimmedName]) {
                    alert('Profile already exists!');
                    return;
                }
                
                profiles[trimmedName] = {
                    sliders: {
                        algorithms: 0,
                        dataStructures: 0,
                        lowLevelDesign: 0,
                        highLevelDesign: 0,
                        kubernetes: 0
                    },
                    progressData: {
                        algorithms: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] },
                        dataStructures: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] },
                        lowLevelDesign: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] },
                        highLevelDesign: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] },
                        kubernetes: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] }
                    }
                };
                
                localStorage.setItem('goalTrackerProfiles', JSON.stringify(profiles));
                switchProfile(trimmedName);
            }

            function deleteProfile() {
                if (currentProfile === 'default') {
                    alert('Cannot delete default profile!');
                    return;
                }
                
                if (Object.keys(profiles).length === 1) {
                    alert('Cannot delete the last profile!');
                    return;
                }
                
                if (!confirm(`Delete profile "${currentProfile}"? This cannot be undone.`)) {
                    return;
                }
                
                delete profiles[currentProfile];
                localStorage.setItem('goalTrackerProfiles', JSON.stringify(profiles));
                
                currentProfile = 'default';
                localStorage.setItem('goalTrackerCurrentProfile', currentProfile);
                switchProfile(currentProfile);
            }

            profileSelect.addEventListener('change', () => switchProfile(profileSelect.value));
            addProfileBtn.addEventListener('click', addProfile);
            deleteProfileBtn.addEventListener('click', deleteProfile);

            sliders.forEach(slider => {
                const element = $(slider.id);
                const labelElement = $(slider.labelId);
                const sliderLabel = labelElement.parentElement.parentElement.querySelector('.slider-label');

                element.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    labelElement.textContent = `${value}%`;
                    state.sliders[slider.id] = value;
                    updateSliderBackground(this);

                    if (state.currentPanel === slider.id) {
                        progressBarFill.style.width = `${value}%`;
                        progressBarFill.textContent = `${value}%`;
                    }
                });

                sliderLabel.addEventListener('click', () => openProgressPanel(slider.id, slider.name));
                updateSliderBackground(element);
            });

            addRowBtn.addEventListener('click', () => {
                if (!state.currentPanel) return;
                const data = state.progressData[state.currentPanel];
                const newRow = new Array(data.columns.length).fill('');
                
                // Auto-fill columns based on type
                data.columns.forEach((col, idx) => {
                    const colName = col.toLowerCase();
                    if (colName.includes('date')) {
                        newRow[idx] = new Date().toISOString().split('T')[0];
                    } else if (colName.includes('hour')) {
                        newRow[idx] = '0';
                    }
                });
                
                data.rows.push(newRow);
                renderTable();
            });

            addColBtn.addEventListener('click', () => {
                columnModal.classList.add('active');
                columnNameInput.value = '';
                columnNameInput.focus();
            });

            confirmColBtn.addEventListener('click', () => {
                const columnName = columnNameInput.value.trim();
                if (!columnName || !state.currentPanel) {
                    alert('Please enter a column name');
                    return;
                }
                const data = state.progressData[state.currentPanel];
                data.columns.push(columnName);
                data.rows.forEach(row => row.push(''));
                columnModal.classList.remove('active');
                renderTable();
            });

            cancelColBtn.addEventListener('click', () => columnModal.classList.remove('active'));
            columnNameInput.addEventListener('keypress', e => e.key === 'Enter' && confirmColBtn.click());
            closePanelBtn.addEventListener('click', closeProgressPanel);
            columnModal.addEventListener('click', e => e.target === columnModal && columnModal.classList.remove('active'));
            progressPanel.addEventListener('click', e => e.target === progressPanel && closeProgressPanel());
        </script>
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
            import { getFirestore, doc, setDoc, getDoc, collection } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

            const firebaseConfig = {
                apiKey: "AIzaSyCFyqtRhXJRiQKgbp2mL48aRYLOKmdVQmw",
                authDomain: "goal-trackerdb.firebaseapp.com",
                projectId: "goal-trackerdb",
                storageBucket: "goal-trackerdb.firebasestorage.app",
                messagingSenderId: "1078222451786",
                appId: "1:1078222451786:web:cdaddf5b6798b3216162b3",
                measurementId: "G-JZHCYSTS9C"
            };

            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            const db = getFirestore(app);

            const defaultProgressData = {
                algorithms: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] },
                dataStructures: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] },
                lowLevelDesign: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] },
                highLevelDesign: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] },
                kubernetes: { columns: ['Date', 'Hours Studied', 'Topics'], rows: [] }
            };

            function convertRowsToObjects(rows) {
                return rows.map(row => {
                    const obj = {};
                    row.forEach((cell, idx) => obj[idx] = cell);
                    return obj;
                });
            }

            function convertRowsToArrays(rows) {
                return rows.map(rowObj => {
                    if (Array.isArray(rowObj)) return rowObj;
                    return Object.keys(rowObj)
                        .sort((a, b) => Number(a) - Number(b))
                        .map(idx => rowObj[idx]);
                });
            }

            async function saveAllData() {
                saveProfiles();
                
                const dataToSave = {
                    sliders: state.sliders,
                    progressData: state.progressData,
                    timestamp: new Date().toISOString()
                };
                
                try {
                    localStorage.setItem('goalTrackerData', JSON.stringify(dataToSave));
                } catch (e) {
                    console.error("localStorage save failed:", e);
                }

                try {
                    const progressDataForFirestore = {};
                    for (const key in state.progressData) {
                        const section = state.progressData[key];
                        progressDataForFirestore[key] = {
                            columns: section.columns,
                            rows: convertRowsToObjects(section.rows)
                        };
                    }
                    
                    await setDoc(doc(collection(db, "goalTracker"), currentProfile), {
                        sliders: state.sliders,
                        progressData: progressDataForFirestore,
                        timestamp: new Date().toISOString()
                    });
                    console.log("‚úì Firestore save successful");
                } catch (error) {
                    console.error("‚úó Firestore save failed (localStorage active):", error);
                }
                
                saveNotification.classList.add('show');
                setTimeout(() => saveNotification.classList.remove('show'), 3000);
            }

            async function loadAllData() {
                let dataLoaded = false;
                
                try {
                    const docRef = doc(collection(db, "goalTracker"), currentProfile);
                    const docSnap = await getDoc(docRef);
                    
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        state.sliders = data.sliders || state.sliders;
                        
                        if (data.progressData) {
                            for (const key in defaultProgressData) {
                                if (data.progressData[key]) {
                                    const section = data.progressData[key];
                                    section.columns = section.columns || defaultProgressData[key].columns;
                                    section.rows = convertRowsToArrays(section.rows || []);
                                    state.progressData[key] = section;
                                } else {
                                    state.progressData[key] = defaultProgressData[key];
                                }
                            }
                        } else {
                            state.progressData = defaultProgressData;
                        }
                        
                        profiles[currentProfile] = {
                            sliders: { ...state.sliders },
                            progressData: JSON.parse(JSON.stringify(state.progressData))
                        };
                        localStorage.setItem('goalTrackerProfiles', JSON.stringify(profiles));
                        
                        dataLoaded = true;
                        console.log("‚úì Firestore load successful");
                    }
                } catch (error) {
                    console.error("‚úó Firestore load failed, using localStorage:", error);
                }
                
                if (!dataLoaded) {
                    try {
                        const savedData = localStorage.getItem('goalTrackerData');
                        if (savedData) {
                            const data = JSON.parse(savedData);
                            state.sliders = data.sliders || state.sliders;
                            
                            if (data.progressData) {
                                for (const key in defaultProgressData) {
                                    if (data.progressData[key]) {
                                        const section = data.progressData[key];
                                        section.columns = section.columns || defaultProgressData[key].columns;
                                        section.rows = section.rows || [];
                                        state.progressData[key] = section;
                                    } else {
                                        state.progressData[key] = defaultProgressData[key];
                                    }
                                }
                            } else {
                                state.progressData = defaultProgressData;
                            }
                            
                            dataLoaded = true;
                            console.log("‚úì localStorage load successful");
                        }
                    } catch (error) {
                        console.error("‚úó localStorage load failed:", error);
                    }
                }
                
                if (dataLoaded) {
                    sliders.forEach(slider => {
                        const element = document.getElementById(slider.id);
                        const labelElement = document.getElementById(slider.labelId);
                        element.value = state.sliders[slider.id];
                        labelElement.textContent = `${state.sliders[slider.id]}%`;
                        updateSliderBackground(element);
                    });
                }
            }

            window.addEventListener('beforeunload', saveAllData);
            window.addEventListener('load', async () => {
                try {
                    loadProfilesList();
                    await loadAllData();
                } catch (e) {
                    console.error('Initialization failed:', e);
                }
            });

            saveBtn.addEventListener('click', saveAllData);
        </script>
</body>

</html>